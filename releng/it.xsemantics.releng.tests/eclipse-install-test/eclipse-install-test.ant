<?xml version="1.0" encoding="UTF-8"?>
<project name="Test Features Installation" default="test.install.in.kepler">
	<import file="common.ant" as="common" />

	<property name="WORKSPACE" location="${ant.file}/../../../../" />
	<property name="build.root" location="${WORKSPACE}/buildroot" />
	<property name="site.p2" location="${sp:repository}" />

	<property name="additional.repos" value="http://download.eclipse.org/modeling/tmf/xtext/updates/composite/releases" />
	<property name="xsemantics.sdk.feature" value="it.xsemantics.sdk.feature.group" />
	<property name="xsemantics.runtime.feature" value="it.xsemantics.runtime.feature.feature.group" />

	<macrodef name="test.install">
		<attribute name="eclipse.name" default="kepler"/>
		<sequential>
			<install.eclipse.features
				eclipse.name="@{eclipse.name}"
				features.repos="${site.p2}"
				additional.repos="${additional.repos}"
				features.to.install="${xsemantics.runtime.feature}"/>
			<test.xtext.installed.versions/>
			<install.eclipse.features
				eclipse.name="@{eclipse.name}"
				features.repos="${site.p2}"
				additional.repos="${additional.repos}"
				features.to.install="${xsemantics.sdk.feature}"/>
			<test.xtext.installed.versions/>
		</sequential>
	</macrodef>
	
	<target name="test.install.in.kepler" description="Test installation in Kepler">
		<test.install/>
	</target>

	<target name="test.install.in.juno" description="Test installation in Juno">
		<test.install
			eclipse.name="juno"/>
	</target>

	<target name="test.install.in.indigo" description="Test installation in Indigo">
		<test.install
			eclipse.name="indigo"/>
	</target>

	<macrodef name="test.xtext.installed.versions">
		<sequential>
			<bundles.exist
				bundle.pattern="*xtext*2.3*.jar"
			/>
			<bundles.dont.exist 
				bundle.pattern="*xtext*2.4*.jar" 
			/>
		</sequential>
	</macrodef>

	<target name="test.bundle.presence" description="Test bundle presence">
		<bundles.exist
			bundle.pattern="*xtext*2.3*.jar"
			eclipse.test.dest="${user.home}/eclipse-install/eclipse-juno-test/"
		/>
	</target>

	<target name="test.bundle.absence" description="Test bundle absence">
		<bundles.dont.exist 
			bundle.pattern="*xtext*2.4*.jar" 
			eclipse.test.dest="${user.home}/eclipse-install/eclipse-juno-test/" />
	</target>

</project>